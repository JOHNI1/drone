<?xml version="1.0" ?>
<robot name="copterPIX" xmlns:xacro="http://www.ros.org/wiki/xacro">


  <xacro:include filename="$(find drone)/xacros/drone_maker.xacro"/>

  

  <xacro:property name="hex_mesh" value="$(find drone)/meshes/hexagonal_prism_height_1_outer_diameter_1.stl"/>
  <xacro:property name="prop_cw_mesh" value="$(find drone)/meshes/iris_prop_cw.dae"/>
  <xacro:property name="prop_ccw_mesh" value="$(find drone)/meshes/iris_prop_ccw.dae"/>


<!-- 
  <xacro:property name="ixx" value="${373162267137.9 / g_mms_to_kg_ms}"/>  these values are not valid, they are stupid wrong
  <xacro:property name="ixy" value="${19971359238.18 / g_mms_to_kg_ms}"/>
  <xacro:property name="ixz" value="${-71155586006.28 / g_mms_to_kg_ms}"/>
  <xacro:property name="iyy" value="${595713038514.03 / g_mms_to_kg_ms}"/>
  <xacro:property name="iyz" value="${50504029566.32 / g_mms_to_kg_ms}"/>
  <xacro:property name="izz" value="${574188826210.05 / g_mms_to_kg_ms}"/> 

  <xacro:property name="iner" value="${ixx} ${ixy} ${ixz} ${iyy} ${iyz} ${izz}" />
-->

  <xacro:property name="base_mesh" value="${hex_mesh}"/>
  <xacro:property name="base_pose_xyz" value="0 0 0"/>
  <xacro:property name="base_pose_rpy" value="0 0 0"/>
  <xacro:property name="base_scale_xyz" value="0.4 0.4 0.04"/>
  <xacro:property name="base_center_of_mass" value="0 0 0"/>
  <xacro:property name="base_mass" value="19" />
  <xacro:property name="base_iner" value="None"/>
  <xacro:property name="number_of_arms" value="6"/>
  <xacro:property name="arm_angles" value="0 180 120 300 60 240"/>
  <xacro:property name="cws" value="1 0 1 0 0 1"/>  <!-- 1: true 0: false -->
  <xacro:property name="prop_meshs" value="${prop_cw_mesh} ${prop_ccw_mesh} ${prop_cw_mesh} ${prop_ccw_mesh} ${prop_ccw_mesh} ${prop_cw_mesh}"/>
  <xacro:property name="dis_from_center" value="0.175"/>
  <xacro:property name="length" value="0.56"/>
  <xacro:property name="diameter" value="0.025"/>
  <xacro:property name="arm_incline_angle" value="5"/>
  <xacro:property name="arm_mesh" value="${hex_mesh}"/>
  <xacro:property name="prop_size_multiplier" value="2.34"/>
  <xacro:property name="cylinder_d" value="0.55"/>
  <xacro:property name="cylinder_l" value="0.02"/>
  <xacro:property name="a_mass" value="0.5"/>
  <xacro:property name="a_iner" value="None"/>
  <xacro:property name="cla" value="4.3"/>
  <xacro:property name="cp" value="0.2"/>
  <xacro:property name="area" value="0.01"/>
  <xacro:property name="r_mass" value="0.2"/>
  <xacro:property name="r_iner" value="0.000312 0 0 0.0053345 0 0.005363328"/>
  <xacro:property name="ardu_multiplier" value="800"/>
  <xacro:property name="ardu_offset" value="0"/>
  <xacro:property name="ardu_p_gain" value="0.2"/>
  <xacro:property name="ardu_i_gain" value="0"/>
  <xacro:property name="ardu_d_gain" value="0"/>
  <xacro:property name="ardu_i_max" value="0"/>
  <xacro:property name="ardu_i_min" value="0"/>
  <xacro:property name="ardu_cmd_max" value="2.5"/>
  <xacro:property name="ardu_cmd_min" value="-2.5"/>


  <xacro:drone_maker base_mesh="${base_mesh}" base_pose_xyz ="${base_pose_xyz}" base_pose_rpy="${base_pose_rpy}" base_scale_xyz="${base_scale_xyz}"
                     base_center_of_mass="${base_center_of_mass}" base_mass="${base_mass}" base_iner="${base_iner}"
                     number_of_arms="${number_of_arms}" arm_angles="${arm_angles}" cws="${cws}" prop_meshs="${prop_meshs}"
                     dis_from_center="${dis_from_center}" length="${length}" diameter="${diameter}" 
                     arm_incline_angle="${arm_incline_angle}" arm_mesh="${arm_mesh}" prop_size_multiplier="${prop_size_multiplier}" 
                     cylinder_d="${cylinder_d}" cylinder_l="${cylinder_l}" a_mass="${a_mass}" a_iner="${a_iner}" 
                     cla="${cla}" cp="${cp}" area="${area}" r_mass="${r_mass}"  r_iner="${r_iner}"
                     ardu_multiplier="${ardu_multiplier}" ardu_offset="${ardu_offset}" 
                     ardu_p_gain="${ardu_p_gain}" ardu_i_gain="${ardu_i_gain}" ardu_d_gain="${ardu_d_gain}"
                     ardu_i_max="${ardu_i_max}" ardu_i_min="${ardu_i_min}" ardu_cmd_max="${ardu_cmd_max}" ardu_cmd_min="${ardu_cmd_min}">

    <extra_ardupilot_plugin_settings>
      <xacro:extra_channel channel="6" _type="POSITION" _multiplier="1" _jointName="fire_trigger_servo_joint"
                                          _offset="0" _p_gain="1" _i_gain="0" _d_gain="0"
                                          _i_max="0" _i_min="0" _cmd_max="2.5" _cmd_min="-2.5"/>
    </extra_ardupilot_plugin_settings>
  </xacro:drone_maker>


  <joint name="leg_0_link_joint" type="fixed">
    <parent link="base_link"/>
    <child link="leg_0_link"/>
  </joint>
  <xacro:link_creator_i link_name="leg_0_link" pose_xyz="0 0.198 -0.305" pose_rpy="0.305 0 0" mesh_path="${hex_mesh}" scale_xyz="0.024 0.024 0.61" mass="0.5"/>
  <joint name="leg_1_link_joint" type="fixed">
    <parent link="base_link"/>
    <child link="leg_1_link"/>
  </joint>
  <xacro:link_creator_i link_name="leg_1_link" pose_xyz="0 -0.198 -0.305" pose_rpy="-0.305 0 0" mesh_path="${hex_mesh}" scale_xyz="0.024 0.024 0.61" mass="0.5"/>

  <joint name="feet_0_link_joint" type="fixed">
    <parent link="base_link"/>
    <child link="feet_0_link"/>
  </joint>
  <xacro:link_creator_i link_name="feet_0_link" pose_xyz="0 0.29 -0.6" pose_rpy="0 1.57079633 0" mesh_path="${hex_mesh}" scale_xyz="0.024 0.024 0.58" mass="0.5"/>

  <joint name="feet_1_link_joint" type="fixed">
    <parent link="base_link"/>
    <child link="feet_1_link"/>
  </joint>
  <xacro:link_creator_i link_name="feet_1_link" pose_xyz="0 -0.29 -0.6" pose_rpy="0 1.57079633 0" mesh_path="${hex_mesh}" scale_xyz="0.024 0.024 0.58" mass="0.5"/>





  <joint name="fire_trigger_servo_joint" type="revolute">
    <parent link="base_link"/>
    <child link="fire_trigger_servo_link"/>
    <origin xyz="0 0 -0.45" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit effort="10000" velocity="4" lower="${pi * -0.5}" upper="${pi * 0.5}"/>
    <dynamics damping="0.1" friction="0"/>
  </joint>
  <gazebo reference="fire_trigger_servo_joint">
    <physics>
      <ode>
        <implicit_spring_damper>1</implicit_spring_damper>
      </ode>
    </physics>
  </gazebo>
<!-- it is neccessary to specify the value here because the inertia becomes too small if done automatically for the following link with such small mass and size! -->
  <xacro:link_creator_i link_name="fire_trigger_servo_link" mesh_path="Box" pose_xyz="0 0 0" pose_rpy="0 0 0" scale_xyz="0.04 0.009 0.009" mass="0.505" iner="0.001 0 0 0.001 0 0.001"/>
  <gazebo reference="fire_trigger_servo_link">
    <material>Gazebo/Red</material>
    <self_collide>0</self_collide>
  </gazebo>
  
</robot>




<!-- 
https://ardupilot.org/copter/docs/connect-escs-and-motors.html



            X
            ^
            |
            |
            | z
  Y <~~~~~~~o~~~~~~~~
            |
            |
            |



                        (front)
                  120deg            60deg         
                  cw (2)           ccw (4)
                    \               /
                     \             /
                       \         /
                        \       /
                          \   /
  180deg  ccw(1) ~~~~~~~~~~~~~~~~~~~~~~~~ cw(0) 0deg
                          /   \
                        /       \
                       /         \
                     /             \
                    /               \
                  cw (5)           ccw (3)
                  240deg           300deg
      
      
      
      positive yaw is ccw and negative is cw

 -->

